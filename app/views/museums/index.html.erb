<table>
  <tr>
    <th></th>
    <th>æ‰€åœ¨åœ°</th>
    <th colspan="2">æ–½è¨­å</th>
    <th>ã‚¸ãƒ£ãƒ³ãƒ«</th>
    <th>è¨ªå•äººæ•°</th>
    <th>ãŠã™ã™ã‚</th>
    <th>ã‚³ãƒ¡ãƒ³ãƒˆæ•°</th>
    <th>å†™çœŸæ•°</th>
    <th><%= link_to 'ï¼‹', new_museum_path %></th>
  </tr>
  <% @museums.each do |museum| %>
  <tr>
    <td>
      <% if user_signed_in? %>
        <% if museum.recommended_by?(current_user) %>
          â˜†
        <% elsif museum.visited_by?(current_user) %>
          ğŸ‘¨
        <% end %>
      <% end %>
    </td>
    <td><%= museum.prefecture %></td>
    <td><%= attachment_image_tag museum, :appearance_image, size:"40x40", format:"jpeg" %></td>
    <td><%= link_to museum.name, museum_path(museum.id) %></td>
    <td><%= museum.genre.name %></td>
    <td><%= museum.visits.count %>äºº</td>
    <td><%= museum.recommends.count %>äºº</td>
    <td><%= museum.posts.count %>ä»¶</td>
    <td>
      <% sum = 0 %>
      <% museum.posts.each do |post| %>
        <% sum += post.post_images.count %>
      <% end %>
      <%= sum %> æš
    </td>
  </tr>
  <% end %>
</table>


<!--åœ°å›³è¡¨ç¤º-->
<div id='map'></div>
  <style>
    #map {
      height: 500px ;
      width: 500px ;
    }
  </style>
<script>
  let map
    function initMap(){
      geocoder = new google.maps.Geocoder()

      map = new google.maps.Map(document.getElementById('map'), {
          center: {lat: 38.258595, lng:137.6850225},
          zoom: 5,
      });

      <% @museums.each do |m| %>
          (function(){
          var contentString = "<%= m.name %>";

          var marker = new google.maps.Marker({
              position:{lat: <%= m.latitude %>, lng: <%= m.longitude %>},
              map: map,
              title: contentString
          });
          // æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦(å¹ãå‡ºã—)ã®å®šç¾©
          // æŠ•ç¨¿ã®è©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ã‚‚
          var infowindow = new google.maps.InfoWindow({
          position: {lat: <%= m.latitude %>, lng: <%= m.longitude %>},
          content: contentString
          });
          // ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«æƒ…å ±ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚’è¡¨ç¤º
          marker.addListener('click', function() {
          infowindow.open(map, marker);
          });
          })();
      <% end %>
      }
</script>
<script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['API_KEY']%>&callback=initMap" async defer></script>